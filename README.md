# Initial_public_offering_price_prediction

## 2023.06.06v
### 1.가설
- 교수님께서 제공해주신 기본 독립변수 15개 이외에도 공모주 시초가 예측에 유의미한 새로운 변수를 찾기 위해서 설정된 가설이다.
- 가설은 다음과 같다. 최근 주식동향, 희망가, 투자자, 저평가 종목을 선별이 공모주 시초가 예측에 유의미한 새로운 독립변수가 될 것으로 추정했다.
 - 최근 주식 동향에 사용된 변수 : 최근 공모주 동향(최근 3개월 내의 종속변수 1인 개수), 최근 3개월 공모주 수, 최근 "따" 비율
 - 희망가에 사용된 변수 : 밴드 수익률, 희망공모가_상한가, 희망공모가_하한가
 - 투자자에 사용된 변수 : 일반 청약자 비율, 전문 투자자 비율  
 - 저평가 종목 선별에 사용된 변수 : ROE
- 즉, 종속변수를 포함한 전체 기본변수 16개에 가설에 사용된 9개의 변수를 추가해서 먼저 모델별로 유의미한 독립변수를 선정 후 
- 모델별로 선정된 독립변수를 기본 변수에 추가하여 다시 모델링을 진행
 

### 2.전처리
- 종속변수가 0과 1이 8:2의 비율이여서 제대로 학습이 불가함
- 오버샘플링을 통해서 5:5로 비율을 맞췄다. 


### 3.유의미한 독립변수 선택
#### 1) 상관계수
- 최근 "따" 비율
- 일반청약자(비율)
- 밴드수익률

#### 2) 로지스틱회귀
- 희망공모가_하한가
- ROE

#### 3) 결정나무(CART)
- 최근 공모주 동향(최근 3개월 내의 종속변수 1인 개수)
- 밴드수익률

#### 4) 결정나무(C5.0)
- 최근 "따" 비율


### 4. 최적의 모델을 찾기 위한 실험
#### 1) 선택된 독립변수 별로 실험 진행 : 즉 위에서 상관계수, 로지스틱회귀, CART, C5.0별로 선택된 독립변수를 각각 기본 15개 변수에 추가하여 실험진행, 이는 기본 변수만 사용했을때와 성능의 차이와 독립변수 선택별로 어떤 기법이 제일 잘 유의미한 독립변수를 잘 뽑아냈는지 확인 후, 최종 사용할 모델을 선택하기 위함이다. 
- 기본변수 : 기본 15개 변수
- 상관계수로 입증한 유의미한 가설 변수 추가 : 기본 15개 변수 + 최근"따"비율, 일반청약자(비율), 밴드수익률
- 로지스틱회귀분석으로 입증한 유의미한 가설 변수 추가 : 기본 15개 변수 + 희망공모가_하한가, ROE
- 결정트리(CART)으로 입증한 유의미한 가설 변수 추가 : 기본 15개 변수 + 최근 공모주 동향(최근 3개월 내의 종속변수 1인 개수), 밴드수익률
- 결정트리(C5.0)으로 입증한 유의미한 가설 변수 추가 : 기본 15개 변수 + 최근 "따" 비율

#### * 추신) 다음과 같이 진행한 이유는 래피드마이터 특강때 CART-LR, C5.0-LR등의 모델을 소개해주셨다. 즉 결정 트리, LR모델로 먼저 유의미한 변수를 선택하고 이를 바탕으로 추가로 모델학습을 진행하는 것이다. 예를 들어서 CART로 독립변수를 선정하고 LR으로 최종 모델을 학습시켰으면 CART-LR 모델이 되는 것이다. 그렇기 때문에 아래에 사용된 모델은 각각 (독립변수를 찾기 위해 사용된 모델-추가진행 모델)로 명칭을 정하면 된다. 

#### 2) 사용된 모델
- 로지스틱회귀모델
- 결정나무(CART)
- 결정나무(C5.0)
- 신경망 3계층
- 신경망 4계층

#### 3) 그리드서치를 사용하여 최적의 하이퍼파리미터를 선정한다.
- 로지스틱 회귀에 사용된 하이퍼파라미터
 - C : 정규화의 강도를 제어한다. C값이 작읈록 모델은 더 많은 정규화를 가진다. 이것은 과적합을 방지하고 모델의 일반화를 도와준다.
 - max-iter : 최대 반복 횟수이다.

- 결정나무에 사용된 하이퍼파라미터
 - criterion : CART인지 C5.0인지 구분하기 위함이다. gini이면 CART이고 entropy이면 C5.0이다.
 - max_depth : 트리의 최대 깊이를 결정한다. 너무 깊으면 과적합을 초래할 수 있기 때문에 조심해야한다.
 - max_features : 각 노드에서 분할에 사용할 수 있는 최대 특징 수를 결정한다.  
 - max_leaf_nodes : 리프 노드의 최대 수를 제한한다. 이는 트리의 크기를 제한하는 또 다른 방법이다.
 - min_samples_leaf : 리프 노드에 있어야 하는 최소 샘플 수를 정의 한다. 이를 통해서 트리가 너무 세부적으로 가는 것으로 가는 것을 방지 한다. 즉 과적합 방지이다.
 - min_samples_split : 각 노드를 분할하기 위한 최소 샘플 수를 결정한다.

- 신경망에 사용된 하이퍼파라미터
 - hidden_layer_sizes : 은닉층의 수와 각각의 크기를 결정한다.
 - learning_rate_init : 초기 학습률을 설정한다. 이는 모델의 학습 속도를 결정하는데 너무 높으면 빨라서 제대로 학습이 되지  않고 너무 낮으면 학습시간이 오래걸린다.
 - max_iter : 최대 반복횟수이다.

### 5. 평가지표
- accuracy로 전체 정확도 확인
- 종속변수 1에 대한 recall : 실제 따상인 것중에서 따상으로 맞춘 갯수

### 6. 신경망은 과적합 현상
- 변수를 어떻게 조절하던 신경망은 정확도 0.85 그리고 1에 대한 recall은 0.9이상 나온다. 
- 데이터 양이 적어서 과적합 된 것으로 보인다.
- 결정나무의 같은 경우에는 독립변수 선택별로 성능차이가 나서 구분이 가능하다.

오버샘플링
- https://github.com/jx-dohwan/Initial_public_offering_price_prediction/blob/main/sampling.ipynb

feature selection
- https://github.com/jx-dohwan/Initial_public_offering_price_prediction/blob/main/sampling.ipynb

1. 기본변수
- https://github.com/jx-dohwan/Initial_public_offering_price_prediction/blob/main/model_%EC%8B%A4%ED%97%981.ipynb

2. 상관계수로 입증한 유의미한 가설 변수 추가
- https://github.com/jx-dohwan/Initial_public_offering_price_prediction/blob/main/model_%EC%8B%A4%ED%97%982.ipynb

3. 로지스틱회귀분석으로 입증한 유의미한 가설 변수 추가
- https://github.com/jx-dohwan/Initial_public_offering_price_prediction/blob/main/model_%EC%8B%A4%ED%97%983.ipynb

4. 결정트리(CART)으로 입증한 유의미한 가설 변수 추가
- https://github.com/jx-dohwan/Initial_public_offering_price_prediction/blob/main/model_%EC%8B%A4%ED%97%984.ipynb

5. 결정트리(C5.0)으로 입증한 유의미한 가설 변수 추가
- https://github.com/jx-dohwan/Initial_public_offering_price_prediction/blob/main/model_%EC%8B%A4%ED%97%985.ipynb

---
#### 일단 변수를 10~15개가 적절하다고 했다. 그렇기 때문에 무엇을 빼야할지에 집중하기 보다는 기존에 사용하였던 변수에 무엇을 추가할지를 생각하는게 더 효과적일 것이다.
#### 데이터를 살펴보니 기존 교수님이 제공해주셨던 데이터의 변수에 5가지를 추가적으로 넣어서 유의미한 출력을 뽑아낼 수 있을 것 같다. 
#### 그리고 6가지당 각각 하나의 변수를 더 사용할 것이다. 왜냐하면 각각 비슷한 변수가 많기는 하지만 특정 비율을 뽑아내기 위한 변수인것 같고 중요한것은 비율인 것 같다. 예를 들어 최근 "따" 비율등이다. 
#### 아니면 여섯개 다 사용하거나 조합을 했을 때 어떤 것이 더 좋은 성능이 나왔는지 파악하는것도 괜찮을 것 같다. 이거는 코드로 직접 파악하며 확인하기
#### 일단 여섯개 다 사용해서 상관관계를 시각화해보자 그리고 상관관계의 시각화가 높은 만큼 실제 값도 높았는지 확인해보자

- 꼭 사용해야할 칼럼
  - 기업명
  - 공모가
  - 기관경쟁률
  - 청약경쟁률
  - 총공모지식수
  - 매출액
  - 순이익
  - 자본금
  - 의무보유확약비율
  - 구주매출비율
  - 종속변수
- 여기에 더 추가할 변수는 카테고리로 나눠보자
  - 주간사가 미치는 영향파악
    - 주간사 순위만 추가로 사용하면 될 듯 
  - 최근 주식 동향이 미치는 영향(3개월->근데 왜 3개월로 정했는지도 이유가 들어가야함)
    - 최근 "따" 비율만 써도 될 것 같음
    - 최근 공모주 동향1과 공모주수를 비율로 나타낸거니까
    - 지금은 이진분류이기 때문에 양수 비율은 중요하지 않을 듯 
   - 밴드수익률
     - 공모주의 가격이 기대치와 얼마나 차이나는지 알수 있게 해주는 것인데 유의미한 정보를 가져다 줄 것으로 보인다. 
  - 전문 투자자 비율
    - 일반청약자(비율)와 조금 겹치는 감이 있다. 하지만 전문 투자자의 의견이 더 중요하기 때문에 둘중에 하나를 선택한다면 전문 투자자 비율을 선택해야한다.
  - 유통 가능한 주식 합계(비율)도 중요해보이는데?흠



구주매출비율이란 기존 대주주가 소유한 주식을 기업공개할 때 내놓아 파는 방법이다. 따라서 청약에 나온 수량만큼 기존 대주주의 지분율은 떨어진다. 예를들어 총 주식수가 100주인데, 이 중에서 기존 50주를 공모한다면, 대주주의 지분율은 100%에서 50%로 떨어지게 된다. 구주매출은 보통 차익실현이 주된 목표이다.

https://solenedu.tistory.com/entry/IPO-%EA%B8%B0%EC%97%85%EA%B3%B5%EA%B0%9C-%EB%B0%A9%EC%8B%9D-%EA%B5%AC%EC%A3%BC%EB%A7%A4%EC%B6%9C-%EC%8B%A0%EC%A3%BC%EA%B3%B5%EB%AA%A8

---
